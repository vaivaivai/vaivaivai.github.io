/** @copyright Reqwest! A general purpose XHR connection manager https://github.com/ded/reqwest */
!function(e,t,n){typeof module!="undefined"&&module.exports?module.exports=n():typeof define=="function"&&define.amd?define(n):t[e]=n()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){if(e._aborted)return n(e.request);if(e._timedOut)return n(e.request,"Request is aborted: timeout");e.request&&e.request[readyState]==4&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request))}}function setHeaders(e,t){var n=t.headers||{},r;n.Accept=n.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var i=typeof FormData!="undefined"&&t.data instanceof FormData;!t.crossOrigin&&!n[requestedWith]&&(n[requestedWith]=defaultHeaders.requestedWith),!n[contentType]&&!i&&(n[contentType]=t.contentType||defaultHeaders.contentType);for(r in n)n.hasOwnProperty(r)&&"setRequestHeader"in e&&e.setRequestHeader(r,n[r])}function setCredentials(e,t){typeof t.withCredentials!="undefined"&&typeof e.withCredentials!="undefined"&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var i=uniqid++,s=e.jsonpCallback||"callback",o=e.jsonpCallbackName||reqwest.getcallbackPrefix(i),u=new RegExp("((^|\\?|&)"+s+")=([^&]+)"),a=r.match(u),f=doc.createElement("script"),l=0,c=navigator.userAgent.indexOf("MSIE 10.0")!==-1;return a?a[3]==="?"?r=r.replace(u,"$1="+o):o=a[3]:r=urlappend(r,s+"="+o),context[o]=generalCallback,f.type="text/javascript",f.src=r,f.async=!0,typeof f.onreadystatechange!="undefined"&&!c&&(f.htmlFor=f.id="_reqwest_"+i),f.onload=f.onreadystatechange=function(){if(f[readyState]&&f[readyState]!=="complete"&&f[readyState]!=="loaded"||l)return!1;f.onload=f.onreadystatechange=null,f.onclick&&f.onclick(),t(lastValue),lastValue=undefined,head.removeChild(f),l=1},head.appendChild(f),{abort:function(){f.onload=f.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=undefined,head.removeChild(f),l=1}}}function getRequest(e,t){var n=this.o,r=(n.method||"GET").toUpperCase(),i=typeof n=="string"?n:n.url,s=n.processData!==!1&&n.data&&typeof n.data!="string"?reqwest.toQueryString(n.data):n.data||null,o,u=!1;return(n["type"]=="jsonp"||r=="GET")&&s&&(i=urlappend(i,s),s=null),n["type"]=="jsonp"?handleJsonp(n,e,t,i):(o=n.xhr&&n.xhr(n)||xhr(n),o.open(r,i,n.async===!1?!1:!0),setHeaders(o,n),setCredentials(o,n),context[xDomainRequest]&&o instanceof context[xDomainRequest]?(o.onload=e,o.onerror=t,o.onprogress=function(){},u=!0):o.onreadystatechange=handleReadyState(this,e,t),n.before&&n.before(o),u?setTimeout(function(){o.send(s)},200):o.send(s),o)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){if(e===null)return undefined;if(e.match("json"))return"json";if(e.match("javascript"))return"js";if(e.match("text"))return"html";if(e.match("xml"))return"xml"}function init(o,fn){function complete(e){o.timeout&&clearTimeout(self.timeout),self.timeout=null;while(self._completeHandlers.length>0)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp=type!=="jsonp"?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);while(self._fulfillmentHandlers.length>0)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;while(self._errorHandlers.length>0)self._errorHandlers.shift()(e,t,n);complete(e)}this.url=typeof o=="string"?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n=e.name,r=e.tagName.toLowerCase(),i=function(e){e&&!e.disabled&&t(n,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))},s,o,u,a;if(e.disabled||!n)return;switch(r){case"input":/reset|button|image|file/i.test(e.type)||(s=/checkbox/i.test(e.type),o=/radio/i.test(e.type),u=e.value,(!s&&!o||e.checked)&&t(n,normalize(s&&u===""?"on":u)));break;case"textarea":t(n,normalize(e.value));break;case"select":if(e.type.toLowerCase()==="select-one")i(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(a=0;e.length&&a<e.length;a++)e.options[a].selected&&i(e.options[a])}}function eachFormElement(){var e=this,t,n,r=function(t,n){var r,i,s;for(r=0;r<n.length;r++){s=t[byTag](n[r]);for(i=0;i<s.length;i++)serial(s[i],e)}};for(n=0;n<arguments.length;n++)t=arguments[n],/input|select|textarea/i.test(t.tagName)&&serial(t,e),r(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var i,s,o,u=/\[\]$/;if(isArray(t))for(s=0;t&&s<t.length;s++)o=t[s],n||u.test(e)?r(e,o):buildParams(e+"["+(typeof o=="object"?s:"")+"]",o,n,r);else if(t&&t.toString()==="[object Object]")for(i in t)buildParams(e+"["+i+"]",t[i],n,r);else r(e,t)}var context=window;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=require("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray=typeof Array.isArray=="function"?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},catch:function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(arguments.length===0)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),e=="map"?t=serializeHash:e=="array"?t=reqwest.serializeArray:t=serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,i=t||!1,s=[],o=encodeURIComponent,u=function(e,t){t="function"==typeof t?t():t==null?"":t,s[s.length]=o(e)+"="+o(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)u(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],i,u);return s.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest});/** @copyright https://mths.be/punycode v1.4.1 by @mathias */
!function(a){function b(a){throw new RangeError(E[a])}function c(a,b){for(var c=a.length,d=[];c--;)d[c]=b(a[c]);return d}function d(a,b){var d=a.split("@"),e="";d.length>1&&(e=d[0]+"@",a=d[1]),a=a.replace(D,".");var f=a.split("."),g=c(f,b).join(".");return e+g}function e(a){for(var b,c,d=[],e=0,f=a.length;f>e;)b=a.charCodeAt(e++),b>=55296&&56319>=b&&f>e?(c=a.charCodeAt(e++),56320==(64512&c)?d.push(((1023&b)<<10)+(1023&c)+65536):(d.push(b),e--)):d.push(b);return d}function f(a){return c(a,function(a){var b="";return a>65535&&(a-=65536,b+=H(a>>>10&1023|55296),a=56320|1023&a),b+=H(a)}).join("")}function g(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:t}function h(a,b){return a+22+75*(26>a)-((0!=b)<<5)}function i(a,b,c){var d=0;for(a=c?G(a/x):a>>1,a+=G(a/b);a>F*v>>1;d+=t)a=G(a/F);return G(d+(F+1)*a/(a+w))}function j(a){var c,d,e,h,j,k,l,m,n,o,p=[],q=a.length,r=0,w=z,x=y;for(d=a.lastIndexOf(A),0>d&&(d=0),e=0;d>e;++e)a.charCodeAt(e)>=128&&b("not-basic"),p.push(a.charCodeAt(e));for(h=d>0?d+1:0;q>h;){for(j=r,k=1,l=t;h>=q&&b("invalid-input"),m=g(a.charCodeAt(h++)),(m>=t||m>G((s-r)/k))&&b("overflow"),r+=m*k,n=x>=l?u:l>=x+v?v:l-x,!(n>m);l+=t)o=t-n,k>G(s/o)&&b("overflow"),k*=o;c=p.length+1,x=i(r-j,c,0==j),G(r/c)>s-w&&b("overflow"),w+=G(r/c),r%=c,p.splice(r++,0,w)}return f(p)}function k(a){var c,d,f,g,j,k,l,m,n,o,p,q,r,w,x,B=[];for(a=e(a),q=a.length,c=z,d=0,j=y,k=0;q>k;++k)p=a[k],128>p&&B.push(H(p));for(f=g=B.length,g&&B.push(A);q>f;){for(l=s,k=0;q>k;++k)p=a[k],p>=c&&l>p&&(l=p);for(r=f+1,l-c>G((s-d)/r)&&b("overflow"),d+=(l-c)*r,c=l,k=0;q>k;++k)if(p=a[k],c>p&&++d>s&&b("overflow"),p==c){for(m=d,n=t;o=j>=n?u:n>=j+v?v:n-j,!(o>m);n+=t)x=m-o,w=t-o,B.push(H(h(o+x%w,0))),m=G(x/w);B.push(H(h(m,0))),j=i(d,r,f==g),d=0,++f}++d,++c}return B.join("")}function l(a){return d(a,function(a){return B.test(a)?j(a.slice(4).toLowerCase()):a})}function m(a){return d(a,function(a){return C.test(a)?"xn--"+k(a):a})}var n="object"==typeof exports&&exports&&!exports.nodeType&&exports,o="object"==typeof module&&module&&!module.nodeType&&module,p="object"==typeof global&&global;(p.global===p||p.window===p||p.self===p)&&(a=p);var q,r,s=2147483647,t=36,u=1,v=26,w=38,x=700,y=72,z=128,A="-",B=/^xn--/,C=/[^\x20-\x7E]/,D=/[\x2E\u3002\uFF0E\uFF61]/g,E={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},F=t-u,G=Math.floor,H=String.fromCharCode;if(q={version:"1.4.1",ucs2:{decode:e,encode:f},decode:j,encode:k,toASCII:m,toUnicode:l},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return q});else if(n&&o)if(module.exports==n)o.exports=q;else for(r in q)q.hasOwnProperty(r)&&(n[r]=q[r]);else a.punycode=q}(this);amo_social_button=amo_social_button||{};ORIENTATION_HORIZONTAL=1;ORIENTATION_VERTICAL=2;TOP_LEFT=1;TOP_RIGHT=2;BOTTOM_LEFT=3;BOTTOM_RIGHT=4;ANIMATION_DISABLED=0;ANIMATION_WAVES=1;ANIMATION_TREMBLE=2;ANIMATION_SHAKE=3;var Button=function(params,document,window){var _this=this;_this.document=document;_this.window=window;this.init(params)};Button.prototype.init=function(params){params=params||{};var _this=this,allow_lang=["en","ru","es"],id=params.id||0,hash=params.hash||false,locale=params.locale!=="ru"?"com":"ru",lang_id=params.locale&&allow_lang.indexOf(params.locale)>-1?params.locale:"en",parent_node=_this.document.querySelector("#amo_social_button_script").parentNode,visitor_id=params.visitor_id||undefined;_this.id=id;_this.hash=hash;_this.collapsed=false;_this.lang_id=lang_id;_this.visitor_id=visitor_id;_this.parent_node=parent_node.tagName!=="HEAD"?parent_node:_this.document.body;_this.server_host="https://gso.amocrm."+locale;_this.forms_host="https://forms.amocrm."+locale+"/forms/assets/js/amoforms.js";_this.locale=locale;if(id>0&&hash){_this.get_settings(id,hash)}_this.langs={en:{made_by:"Made by "},ru:{made_by:"Сделано в "},es:{made_by:"Hecho por "}}};Button.prototype.get_settings=function(id,hash){var _this=this;reqwest({url:_this.server_host+"/social_button/settings/?client_version=2&id="+id+"&hash="+hash,method:"get",success:function(res){if(res.status==200){var hostname=punycode.toASCII(window.location.hostname),can_render=false,button_settings=res.response.result?res.response:res.response[id];Object.keys(button_settings.domains).map(function(objectKey,index){if(can_render===false){var value=punycode.toASCII(button_settings.domains[objectKey]);if(value.search(hostname)!==-1){can_render=true;_this.check_settings(button_settings);_this.render();return false}}})}}})};Button.prototype.check_settings=function(button_settings){var button_size;this.settings=button_settings.settings;this.settings.date_update=button_settings.date_update;switch(this.getVersion()){case 2:button_size=parseInt(this.settings.button.size);this.settings.button.size=isNaN(button_size)?50:button_size;if(this.settings.button.fixed==="Y"){this.parent_node=document.body}break;case 1:default:button_size=parseInt(this.settings.button.button_size);this.settings.button.button_size=isNaN(button_size)?50:button_size;this.orientation=parseInt(this.settings.button["orient"]);if(!this.settings.button.is_fixed){this._checkIfVerticalNotFixed()}if(this.settings.button.is_fixed==="Y"){this.parent_node=document.body}}this.services_count=Object.keys(this.settings.social_services).length};Button.prototype.getVersion=function(){return this.settings?this.settings.version?this.settings.version:1:false};Button.prototype._checkIfVerticalNotFixed=function(){this.settings.button.button_position="bottom-left"};Button.prototype.render=function(){var _this=this,link=document.createElement("link"),keyframes_link;if(_this.getVersion()===2){link.href=_this.server_host+"/css/v2/main.css";if(this.getAnimation()!==ANIMATION_DISABLED){keyframes_link=document.createElement("link");keyframes_link.href=_this.server_host+"/css/v2/keyframes.css";keyframes_link.rel="stylesheet";_this.document.head.appendChild(keyframes_link)}}else{link.href=_this.server_host+"/css/main.css"}link.rel="stylesheet";_this.document.head.appendChild(link);var load_interval=setInterval(function(){for(var i=0;i<document.styleSheets.length;i++){var sheet=document.styleSheets[i];if(sheet.href===link.href){clearInterval(load_interval);if(_this.getVersion()===2){_this.renderFrame()}else{_this.render_frame()}}}},10)};Button.prototype.renderFrame=function(){var frame_src=this.server_host+"/buttons/v2/html/"+this.hash+".html?"+this.settings.date_update,soc_frame=this.document.createElement("iframe"),brand_link_holder,main_button,button_holder,frame,is_fixed=this.settings.button.fixed==="Y",size=parseInt(this.settings.button.size),orientation=parseInt(this.settings.button.orientation),position=this.makePositionParams(),animation=this.getAnimation(),theme=this.settings.button.theme,_this=this;button_holder=this.renderHolder(is_fixed,size,orientation);main_button=this.renderMainButton(button_holder,is_fixed,position);this.setFrame(soc_frame,frame_src,2);button_holder.insertBefore(soc_frame,button_holder.children[0]);brand_link_holder=this.renderBrand(button_holder,size);this.setOrientation(button_holder,soc_frame,orientation,size,position);this.setBrandPosition(brand_link_holder,orientation,position);this.setPosition(button_holder,soc_frame,is_fixed,position);this.displayAnimation(main_button,animation);soc_frame.onload=function(){frame=_this.window.frames["social_iframe"];_this.set_social(_this.settings);main_button.addEventListener("click",function(e){e.stopPropagation();_this.onButtonClick(main_button,brand_link_holder,animation,theme);frame.postMessage("click_horisontal","*");return false})}};Button.prototype.getButtonColor=function(){return this.settings.button.color};Button.prototype.getAnimation=function(){return this.settings.button.animation?parseInt(this.settings.button.animation):ANIMATION_DISABLED};Button.prototype.onButtonClick=function(button,brand_link,animation,theme){var switching_param=this.getParamToNull(),_this=this;if(!this.collapsed){this.collapsed=true;this.soc_frame.elem[switching_param]=this.soc_frame[switching_param];button.classList.add("maincollapsed");this.setBackgroundColor(button,theme==="white"?"#FFF":"#000");brand_link.classList.add("collapsed");this.hideAnimation(button)}else{this.collapsed=false;button.classList.remove("maincollapsed");brand_link.classList.remove("collapsed");if(this.is_form_shown){this.hideForm()}this.setBackgroundColor(button,this.getButtonColor());this.displayAnimation(button,animation);var timer=setTimeout(function(){if(_this.collapsed!==true){_this.soc_frame.elem[switching_param]=0}clearTimeout(timer)},1e3)}};Button.prototype.displayAnimation=function(main_button,animation){var animation_class;switch(animation){case ANIMATION_DISABLED:return;case ANIMATION_WAVES:animation_class="amo_animation_waves";break;case ANIMATION_TREMBLE:animation_class="amo_animation_tremble";break;case ANIMATION_SHAKE:animation_class="amo_animation_shake"}main_button.className+=" "+animation_class};Button.prototype.hideAnimation=function(main_button){main_button.className=main_button.className.replace(/\bamo_animation_[a-z]+\b/g,"")};Button.prototype.isMobileDevice=function(){var width=window.innerWidth>0?window.innerWidth:screen.width;return width<640};Button.prototype.makePositionParams=function(){var is_mobile=this.isMobileDevice(),x,y,v,h;h=parseInt(this.settings.button.position)%2===0?"right":"left";v=parseInt(this.settings.button.position)>2?"bottom":"top";if(is_mobile){x=this.settings.button.x_offset_m;y=this.settings.button.y_offset_m}else{x=this.settings.button.x_offset;y=this.settings.button.y_offset}return{x:x,y:y,v:v,h:h}};Button.prototype.setBrandPosition=function(brand_holder,orientation,position){if(orientation===ORIENTATION_VERTICAL){if(position.v==="top"){brand_holder.style.top="-18px"}if(position.v==="bottom"){brand_holder.style.bottom="-13px"}}else{brand_holder.style.bottom="-13px"}};Button.prototype.renderHolder=function(is_fixed,size,orientation){var button_holder=this.document.createElement("div");button_holder.className="amo-button-holder "+(orientation===2?"amo-vertical":"amo-horisontal");button_holder.style.position=is_fixed?"fixed":"absolute";button_holder.innerHTML='<div class="amo-button amo-button--main js-amo-button" id="amobutton" style="width:'+size+"px; height:"+size+'px">'+'<div class="amo-button--main-icon"></div>'+"</div>";if(is_fixed){button_holder.style.zIndex=parseInt(Date.now())}this.parent_node.appendChild(button_holder);return button_holder};Button.prototype.renderMainButton=function(button_holder,is_fixed,position){var main_button=button_holder.querySelector(".js-amo-button");this.setBackgroundColor(main_button,this.getButtonColor());main_button.style.float=is_fixed===""?"left":position.h;return main_button};Button.prototype.setBackgroundColor=function(element,color){element.style.backgroundColor=color};Button.prototype.renderBrand=function(button_holder,size){var brand_link_holder=this.document.createElement("div"),url_promo="http://amocrm."+this.locale;if(this.lang_id==="es"){url_promo+="/es/"}brand_link_holder.className="amo-brand";brand_link_holder.id="amo_brand";brand_link_holder.style.width=size+"px";brand_link_holder.innerHTML='<p class="amo-brand__link-holder"><a target="_blank" href="'+url_promo+'" class="amo-brand__link"> amocrm </a></p>';button_holder.appendChild(brand_link_holder);return brand_link_holder};Button.prototype.setOrientation=function(button_holder,soc_frame,orientation,size,position){var style;if(orientation===ORIENTATION_VERTICAL){switch(position.v){case"top":button_holder.style.paddingBottom=7+(size+10)*this.services_count+"px";style="top: "+(size-5)+"px; bottom: inherit;";if(position.h==="right"){style+=" right: 0; left: inherit;"}else{style+=" left: 0; right: inherit;"}soc_frame.setAttribute("style",style);break;case"bottom":button_holder.style.paddingTop=7+(size+10)*this.services_count+"px";style="bottom: "+(size-5)+"px; top: inherit;";if(position.h==="right"){style+=" right: 0; left: inherit;"}else{style+=" left: 0; right: inherit;"}soc_frame.setAttribute("style",style);break}}else{switch(position.h){case"left":soc_frame.setAttribute("style","left: "+(size-15)+"px; right: inherit;");break;case"right":soc_frame.setAttribute("style","right: "+(size-15)+"px; left: inherit;");break}}};Button.prototype.setPosition=function(button_holder,soc_frame,is_fixed,position){button_holder.style[position.h]=position.x+"px";button_holder.style[position.v]=position.y+"px"};Button.prototype.checkIfFormsNeeds=function(){var is_need_forms=parseInt(this.settings.button.form)!==0;if(is_need_forms){this.renderForms()}};Button.prototype.renderForms=function(){var data=this.getFormData();this.insertForms(data)};Button.prototype.render_frame=function(){var _this=this,is_fixed=_this.settings.button.is_fixed,soc_frame=_this.document.createElement("iframe"),button_holder=_this.document.createElement("div"),brand_link_holder=_this.document.createElement("div"),frame_src=_this.server_host+"/buttons/html/"+_this.hash+".html?"+_this.settings.date_update,button_position=_this.settings.button.button_position.split("-"),url_promo="http://amocrm."+_this.locale,main_button,frame;if(_this.lang_id==="es"){url_promo+="/es/"}button_holder.className="amo-button-holder "+(_this.orientation===2?"amo-vertical":"amo-horisontal");button_holder.style.position=is_fixed?"fixed":"absolute";button_holder.innerHTML='<div class="amo-button amo-button--main js-amo-button" id="amobutton" style="width:'+_this.settings.button.button_size+"px; height:"+_this.settings.button.button_size+'px"></div>';if(is_fixed){button_holder.style.zIndex=parseInt(Date.now())}_this.parent_node.appendChild(button_holder);_this.button_holder=button_holder;main_button=button_holder.querySelector(".js-amo-button");if(_this.settings.button.hasOwnProperty("color")){main_button.style.backgroundColor=_this.settings.button["color"]}main_button.style.float=_this.settings.button.is_fixed===""?"left":button_position[1];this.setFrame(soc_frame,frame_src);button_holder.insertBefore(soc_frame,button_holder.children[0]);button_holder.style.height=_this.soc_frame.height+"px";if(this.orientation===2){switch(button_position[0]){case"top":button_holder.style.paddingBottom=7+(_this.settings.button.button_size+10)*_this.services_count+"px";break;case"bottom":button_holder.style.paddingTop=7+(_this.settings.button.button_size+10)*_this.services_count+"px";break}}brand_link_holder.className="amo-brand";brand_link_holder.id="amo_brand";_this.brand_holder=brand_link_holder;if(_this.orientation===1){brand_link_holder.style[is_fixed?button_position[1]:"left"]="7px"}brand_link_holder.innerHTML='<p class="amo-brand__link-holder" style="float: '+(is_fixed?button_position[1]:"left")+'">'+_this.langs[_this.lang_id]["made_by"]+' <a target="_blank" href="'+url_promo+'" class="amo-brand__link">amoCRM</a></p>';button_holder.appendChild(brand_link_holder);if(_this.orientation===2){_this.setVerticalBrandPos(button_position)}if(_this.settings.button.is_fixed==="Y"){button_holder.style[button_position[1]]=(_this.settings.button.horisontal_position===""?0:_this.settings.button.horisontal_position)+"px";button_holder.style[button_position[0]]=(_this.settings.button.vertical_position===""?0:_this.settings.button.vertical_position)+"px";if(button_position[1]=="right"){soc_frame.setAttribute("style","right:0; left: inherit")}}else if(_this.orientation===2){button_holder.style.bottom=0}soc_frame.onload=function(){frame=_this.window.frames["social_iframe"];_this.set_social(_this.settings);main_button.addEventListener("click",function(e){e.stopPropagation();_this.onClick(main_button,brand_link_holder);frame.postMessage("click_horisontal","*");return false});_this.checkIfFormsNeeds()}};Button.prototype.onClick=function(button,brand_link){var _this=this,switching_param=_this.getParamToNull();if(!_this.collapsed){_this.collapsed=true;_this.soc_frame.elem[switching_param]=_this.soc_frame[switching_param];button.classList.add("maincollapsed");brand_link.classList.add("collapsed")}else{_this.collapsed=false;button.classList.remove("maincollapsed");brand_link.classList.remove("collapsed");if(_this.is_form_shown){_this.hideForm()}var timer=setTimeout(function(){if(_this.collapsed!==true){_this.soc_frame.elem[switching_param]=0}clearTimeout(timer)},1e3)}};Button.prototype.getParamToNull=function(){return parseInt(this.orientation)===1?"width":"height"};Button.prototype.setFrame=function(soc_frame,frame_src,version){var _this=this;_this.soc_frame={};_this.soc_frame.elem=soc_frame;this.setSizes(version);soc_frame.id="social_iframe";soc_frame.setAttribute("name","social_iframe");soc_frame.src=frame_src;soc_frame.scrolling="no";soc_frame.className="amo-button__iframe"};Button.prototype.setSizes=function(version){var is_vertical;is_vertical=version===2?parseInt(this.settings.button.orientation)===2:parseInt(this.orientation)===2;if(is_vertical){this.setVerticalSizes(version)}else{this.setHorisontalSizes(version)}};Button.prototype.setVerticalSizes=function(version){var count=this.services_count;if(version===2){this.soc_frame.width=this.settings.button.size+18;this.soc_frame.height=(this.settings.button.size-6)*count+40;this.soc_frame.elem.width=this.soc_frame.width*2;this.soc_frame.elem.height=this.soc_frame.height}else{this.soc_frame.width=this.settings.button.button_size+14;this.soc_frame.height=this.settings.button.button_size+14+(this.settings.button.button_size+10)*count;this.soc_frame.elem.width=this.soc_frame.width;this.soc_frame.elem.height=0}};Button.prototype.setHorisontalSizes=function(version){var count=this.services_count;if(version===2){this.soc_frame.width=(this.settings.button.size-6)*count+40;this.soc_frame.height=this.settings.button.size+35;this.soc_frame.elem.width=this.soc_frame.width;this.soc_frame.elem.height=this.soc_frame.height}else{this.soc_frame.width=this.settings.button.button_size+14+(this.settings.button.button_size+10)*count;this.soc_frame.height=this.settings.button.button_size+14+20;this.soc_frame.elem.width=0;this.soc_frame.elem.height=this.soc_frame.height}};Button.prototype.set_social=function(data){var _this=this;data.locale=_this.locale;data.button.id=_this.id;data.button.hash=_this.hash;data.button.visitor_id=_this.visitor_id;_this.window.frames["social_iframe"].postMessage({action:"set_social",data:data},"*")};Button.prototype.setVerticalBrandPos=function(pos_arr){var brand_el=this.brand_holder,width=brand_el.offsetWidth,horisontal=pos_arr[1],vertical=pos_arr[0];brand_el.style[vertical]="7px";if(vertical=="bottom"){switch(horisontal){case"left":brand_el.style.left="-3px";brand_el.className+=" amo-brand--bl";break;case"right":brand_el.style.bottom="-10px";brand_el.style.right="-"+(width+3)+"px";brand_el.className+=" amo-brand--br";break}}else if(vertical=="top"){switch(horisontal){case"left":brand_el.style.top="-10px";brand_el.style.left="-"+(width+3)+"px";brand_el.className+=" amo-brand--tl";break;case"right":brand_el.style.right="-3px";brand_el.className+=" amo-brand--tr";break}}};Button.prototype.insertForms=function(data){var body=document.body,form_data=data||{},script_el=document.createElement("script"),form_wrapper=this.createFormWrapper();window.amo_forms_params=form_data;script_el.id="amoforms_script";script_el.src=this.forms_host;form_wrapper.appendChild(script_el);this.addFormClickListener()};Button.prototype.addFormClickListener=function(){var _this=this;if(window.addEventListener){window.addEventListener("message",function(e){_this.onMessage(e)})}};Button.prototype.onMessage=function(e){var _this=this,data=e.data;try{data=JSON.parse(data)}catch(err){data=data}switch(true){case data==="click_form":_this.showForm();break;case!!(typeof data==="object"&&data.func&&data.func==="resizeForm"&&data.height):_this.resizeFormFrame(data.height);break}};Button.prototype.resizeFormFrame=function(form_height){this.form_wrapper.style.height=form_height+"px";this.setFormPosition(form_height)};Button.prototype.showForm=function(){var _this=this,shown="amo-form-wrapper_shown";if(this.form_wrapper.classList){this.form_wrapper.classList.add(shown)}else{this.form_wrapper.className+=" "+shown}_this.is_form_shown=true;if(window.addEventListener){document.addEventListener("click",function(e){_this.hideForm(e)})}};Button.prototype.hideForm=function(){var shown="amo-form-wrapper_shown";if(this.form_wrapper.classList){this.form_wrapper.classList.remove(shown)}else{this.form_wrapper.className=this.form_wrapper.className.replace(new RegExp("(^|\\b)"+shown.split(" ").join("|")+"(\\b|$)","gi")," ")}if(this.is_form_shown){this.is_form_shown=false}};Button.prototype.getFormData=function(){var _this=this,services_list=this.settings.social_services,key,form_data={};for(key in services_list){if(services_list[key].type==="form"){form_data={id:services_list[key].id,hash:services_list[key].link,locale:_this.locale,type:"gso"};break}}return form_data};Button.prototype.createFormWrapper=function(){var form_wrapper=document.createElement("div"),defaults={width:"306px",height:"500px"};form_wrapper.style.width=defaults.width;form_wrapper.style.height=defaults.height;form_wrapper.className="amo-form-wrapper";this.form_wrapper=form_wrapper;this.button_holder.appendChild(form_wrapper);return form_wrapper};Button.prototype.setFormPosition=function(form_height){console.log("setFormPosition");var _this=this,button_position=_this.settings.button.button_position.split("-");if(_this.orientation===2){_this.form_wrapper.style[button_position[1]]=_this.soc_frame.width+10+"px";_this.form_wrapper.style[button_position[0]]=0}else if(_this.orientation===1){_this.form_wrapper.style[button_position[0]]=_this.soc_frame.height+10+"px";_this.form_wrapper.style[button_position[1]]=0}};(function(document,window){var ButtonLoader=new Button(amo_social_button,document,window)})(document,window);
